
function Circle(a){a=a||{};this.radius=a.radius||5;this.position=a.position||{x:0,y:0};this.color=a.color||0;this.color_active=a.color_active||0;this.fillAlpha=a.fillAlpha||0.9;this.fillAlpha_active=a.fillAlpha_active||0.5}function Director(c,a,b){this.now;this.dt;this.then=Date.now();b=b||{};this.WIDTH=c||640;this.HEIGHT=a||480}Director.prototype.animate=function(){this.now=Date.now();this.dt=this.now-this.then;requestAnimationFrame(this.animate.bind(this));this.updateAndRender(this.dt);if(this.close_sprite.mouse_over||this.close_sprite.mouse_out){var a=1000/this.framesPerSecond;var b=new Date().getTime();this.close_sprite.gotoAndStop((Math.floor(b/a)%this.close_sprite.totalFrames))}this.then=this.now};Director.prototype.updateAndRender=function(a){this.update(a);this.render()};Director.prototype.update=function(a){};Director.prototype.render=function(){};function Slide(e,a,d,c,b){this.width=e/2||640;this.height=a||480;this.width_cached=this.width;this.height_cached=this.height;this.height=a;this.img_src=d;this.img=c||null;this.is_left=b?true:false;this.cached_width=this.width;this.anchor={x:0,y:0};this.position={x:0,y:0};this.cached_position={x:0,y:0};this.temp_position={x:0,y:0}}Slide.prototype.cache_width=function(){this.cached_width=this.width};Slide.prototype.cache_position=function(){this.cached_position.x=this.position.x;this.cached_position.y=this.position.y};Slide.prototype.restoreCachedWidth=function(){this.width=this.cached_width};Slide.prototype.restoreCachedPosition=function(){this.position.x=this.cached_position.x;this.position.y=this.cached_position.y};Slide.prototype.saveTempPosition=function(){this.temp_position.x=this.position.x;this.temp_position.y=this.position.y};Slide.prototype.cache_size=function(){this.width_cached=this.width;this.height_cached=this.height};SlideManagerBase.prototype=Object.create(Director.prototype);function SlideManagerBase(c,a,b){Director.call(this,c,a,b);b=b||{};this.SLIDE_DURATION=b.slide_duration||300;this.SLIDE_PERCENT_Y=b.slide_percent_y||0.5;this.CIRCLE_COLOR=b.indicator_color||0;this.CIRCLE_COLOR_ACTIVE=b.indicator_color_active||0;this.CIRCLE_FILLALPHA=b.indicator_fillAlpha||0.9;this.CIRCLE_FILLALPHA_ACTIVE=b.indicator_fillAlpha_active||0.5;this.CIRCLE_RADIUS=b.indicator_radius||8;this.CIRCLE_MARGIN=b.indicator_margin||25;this.CIRCLE_PERCENT_Y=b.indicator_percent_y||0.9;this.BKG_COLOR=b.bkg_color||0;this.scale=b.scale||this.SCALES.FIT;this.animationDuration=1.5;this.framesPerSecond=12;this.has_indicators=b.has_indicators||true;this.speed=this.WIDTH/this.SLIDE_DURATION;this.is_accelerated=b.is_accelerated||false;this.initial_speed=this.is_accelerated?(2*this.WIDTH/this.SLIDE_DURATION):this.speed;this.acceleration=this.is_accelerated?(this.initial_speed/this.SLIDE_DURATION):0;this.is_auto_slide=(b.is_auto_slide==true)?true:false;this.interval=b.interval||1000;this.zoom_ratio=b.zoom_ratio||2;this.zoom_interval=b.zoom_interval||300;this.position="neutral";this.states={still:{duration:null},sliding_left:{duration:this.SLIDE_DURATION},sliding_right:{duration:this.SLIDE_DURATION},zoomming_in:{},zoomming_out:{},inspecting:{}};this.state=this.states.still;this.state_time=0;this.slides=[];this.slide_count=0;this.indicators=[];this.is_position_adjusted=false;this.onInit=b.onInit||null;this.onSlideBegin=b.onSlideBegin||null;this.onSlideEnd=b.onSlideEnd||null}SlideManagerBase.prototype.getZoomedLength=function(b,a){return 0.37*b*Math.log(a+(1+Math.sqrt(1+4*this.zoom_interval))/2)};SlideManagerBase.prototype.zoomIn=function(){if(this.state!==this.states.still){return}this.state=this.states.zoomming_in;this.state_time=0;var a=this.getActiveSlide();if(a){a.cache_position();a.saveTempPosition();a.cache_size()}};SlideManagerBase.prototype.zoomOut=function(){if(this.state!==this.states.inspecting){return}var a=this.getActiveSlide();if(a){a.restoreCachedPosition()}this.state=this.states.zoomming_out;this.state_time=0};SlideManagerBase.prototype.update=function(b){Director.prototype.update.call(this,b);if(this.slide_count<2){return}this.state_time+=b;switch(this.state){case this.states.still:if(this.is_auto_slide===true&&this.state_time>this.interval){this.slideLeft()}this.adjustScale();break;case this.states.zoomming_in:if(this.state_time>this.zoom_interval){this.state=this.states.inspecting;this.state_time=0}else{var a=this.getActiveSlide();a.width=this.getZoomedLength(a.width_cached,this.state_time);a.height=this.getZoomedLength(a.height_cached,this.state_time)}break;case this.states.zoomming_out:var a=this.getActiveSlide();if(this.state_time>this.zoom_interval){this.state=this.states.still;this.state_time=0;a.width=a.width_cached;a.height=a.height_cached}else{a.width=3*a.width_cached-this.getZoomedLength(a.width_cached,this.state_time);a.height=3*a.height_cached-this.getZoomedLength(a.height_cached,this.state_time)}break;case this.states.inspecting:default:switch(this.state){case this.states.sliding_left:this.updateSliding(b);break;case this.states.sliding_right:this.updateSliding(b);break;default:break}this.adjustScale();break}};SlideManagerBase.prototype.updateSliding=function(){var j=(Date.now()-this.animationStart)/(this.animationDuration*1000);var g=0.61,f=0.08,d=0.59,c=1.01;var a=new UnitBezier(g,f,d,c);var e=a.solve(j,UnitBezier.prototype.epsilon);var h=1-e;for(var b=0;b<this.slide_count;b++){if(j>1){this.slides[b].position.x=this.slides[b].endPosition.x;if(this.slides[b].to_bigger){this.slides[b].width=this.WIDTH}else{if(this.slides[b].to_smaller){this.slides[b].width=this.WIDTH/2}}this.state=this.states.still;this.slides[b].cache_width()}else{if(this.slides[b].startPosition.x===this.slides[b].endPosition.x){this.slides[b].position.x=this.slides[b].startPosition.x}else{this.slides[b].position.x=(this.slides[b].startPosition.x*h)+(this.slides[b].endPosition.x*e)}if(this.slides[b].to_bigger){this.slides[b].width=(this.slides[b].cached_width*h)+(this.WIDTH*e)}else{if(this.slides[b].to_smaller){this.slides[b].width=(this.slides[b].cached_width*h)+(this.WIDTH/2*e)}}if((this.slides[b].startPosition.x!==this.slides[b].endPosition.x)&&(Math.abs(this.slides[b].position.x-this.slides[b].startPosition.x)>=Math.abs(this.slides[b].endPosition.x-this.slides[b].startPosition.x))){this.slides[b].position.x=this.slides[b].endPosition.x;if(this.slides[b].to_bigger){this.slides[b].width=this.WIDTH}else{if(this.slides[b].to_smaller){this.slides[b].width=this.WIDTH/2}}this.state=this.states.still}}if(this.state===this.states.still){for(var b=0;b<this.slide_count;b++){this.slides[b].cache_width();this.slides[b].to_bigger=false;this.slides[b].to_smaller=false}}}};SlideManagerBase.prototype.getSpeed=function(){if(this.state===this.states.still){return 0}if(this.is_accelerated){return this.initial_speed-this.acceleration*this.state_time}else{return this.initial_speed}};SlideManagerBase.prototype.getActiveSlide=function(){if(!this.slides.length){return false}var a=this.slides.reduce(function(c,b){return Math.abs(c.position.x-this.WIDTH/2)<Math.abs(b.position.x-this.WIDTH/2)?c:b}.bind(this));return a};SlideManagerBase.prototype.getActiveSlides=function(){if(!this.slides.length){return false}var a={};this.slides.forEach(function(b){if(b.is_active&&b.is_left){a.left=b}else{if(b.is_active){a.right=b}}});return a};SlideManagerBase.prototype.getActiveIndex=function(){if(!this.slides.length){return false}return this.slides.indexOf(this.getActiveSlide())};SlideManagerBase.prototype.adjustCircles=function(){var b=this.slides.indexOf(this.getActiveSlide());for(var c=0,a=this.indicators.length;c<a;c++){this.indicators[c].color=this.CIRCLE_COLOR;this.indicators[c].fillAlpha=this.CIRCLE_FILLALPHA}this.indicators[b].color=this.CIRCLE_COLOR_ACTIVE;this.indicators[b].fillAlpha=this.CIRCLE_FILLALPHA_ACTIVE};SlideManagerBase.prototype.adjustScale=function(){for(var f=0,b=this.textures.length;f<b;f++){var d=this.slides[f].width/this.slides[f].height;var e=this.textures[f].height;var c=e*d;var a=this.textures[f].width/2-c/2;this.textures[f].frame.x=a;this.textures[f].frame.width=c}};SlideManagerBase.prototype.adjustPosition=function(){return;if(this.is_position_adjusted){return}var b=this.slides.reduce(function(d,c){return d.position.x<c.position.x?d:c}.bind(this));var a=this.slides.reduce(function(d,c){return d.position.x>c.position.x?d:c}.bind(this));if(this.state===this.states.sliding_left&&b.position.x<this.WIDTH/2&&b!==this.getActiveSlide()){b.position.x=a.position.x+this.WIDTH;b.cached_position.x=a.cached_position.x+this.WIDTH}else{if(this.state===this.states.sliding_right&&a.position.x>this.WIDTH/2&&a!==this.getActiveSlide()){a.position.x=b.position.x-this.WIDTH;a.cached_position.x=b.cached_position.x-this.WIDTH}}this.is_position_adjusted=true};SlideManagerBase.prototype.slideLeft=function(){if(this.position==="left"){return}var a=this.getActiveSlides();a.left.startPosition={x:a.left.position.x};a.right.startPosition={x:a.right.position.x};if(this.position==="neutral"){this.position="left";a.left.to_smaller=false;a.left.endPosition={x:a.left.position.x-this.WIDTH/2};a.right.to_bigger=true;a.right.endPosition={x:a.right.position.x-this.WIDTH/2}}else{if(this.position==="right"){this.position="neutral";a.left.to_smaller=true;a.left.endPosition={x:a.left.position.x};a.right.to_bigger=false;a.right.endPosition={x:a.right.position.x-this.WIDTH/2}}}if(this.state!==this.states.still){return}if(this.onSlideBegin){this.onSlideBegin()}this.is_position_adjusted=false;this.cache_slide_positions();this.state=this.states.sliding_left;this.state_time=0;this.animationStart=Date.now()};SlideManagerBase.prototype.slideRight=function(){if(this.position==="right"){return}var a=this.getActiveSlides();a.left.startPosition={x:a.left.position.x};a.right.startPosition={x:a.right.position.x};if(this.position==="neutral"){this.position="right";a.left.to_bigger=true;a.left.endPosition={x:a.left.position.x};a.right.to_smaller=false;a.right.endPosition={x:a.right.position.x+this.WIDTH/2}}else{if(this.position==="left"){this.position="neutral";a.left.to_bigger=false;a.left.endPosition={x:a.left.position.x+this.WIDTH/2};a.right.to_smaller=true;a.right.endPosition={x:a.right.position.x+this.WIDTH/2}}}if(this.state!==this.states.still){return}if(this.onSlideBegin){this.onSlideBegin()}this.is_position_adjusted=false;this.cache_slide_positions();this.state=this.states.sliding_right;this.state_time=0;this.animationStart=Date.now()};SlideManagerBase.prototype.panTo=function(b,c){if(this.state!==this.states.inspecting){return}var a=this.getActiveSlide();if(a){if(b-0.5*a.width>=0||b+0.5*a.width<=this.WIDTH){}else{a.position.x=b}if(c-0.5*a.height>=0||c+0.5*a.height<=this.HEIGHT){}else{a.position.y=c}}};SlideManagerBase.prototype.startAutoSlide=function(a){this.interval=a||this.interval;this.is_auto_slide=true};SlideManagerBase.prototype.stopAutoSlide=function(){this.is_auto_slide=false};SlideManagerBase.prototype.cache_slide_positions=function(){for(var a=0;a<this.slide_count;a++){this.slides[a].cache_position()}};SlideManagerBase.prototype.setSlidesAndStart=function(b,a){this.setSlides(b,a);this.init();this.animate()};SlideManagerBase.prototype.setSlides=function(f,e,b){b=b||{};var d=b.width||this.WIDTH;var a=b.height||this.HEIGHT;if(f.length!=e.length){return}this.slide_count=f.length+e.length;for(var c=0;c<f.length;c++){if(typeof(f[c])==="string"){this.slides.push(new Slide(d,a,f[c],null,true));this.slides.push(new Slide(d,a,e[c],null,false))}else{this.slides.push(new Slide(d,a,null,f[c],true));this.slides.push(new Slide(d,a,null,e[c],false))}}};SlideManagerBase.prototype.init=function(){var b=this.slide_count;var f=this.WIDTH/2-(b-1)*this.CIRCLE_MARGIN/2;for(var e=0;e<b;e++){var a=this.slides[e];a.anchor.x=0;a.anchor.y=0;if(a.is_left){a.position.x=0}else{a.position.x=this.WIDTH/2}a.is_active=true;switch(this.scale){case this.SCALES.STRETCH:a.width=this.WIDTH;a.height=this.HEIGHT;case this.SCALES.FIT:var d=a.width/a.height;if(d>this.WIDTH/this.HEIGHT){a.width=this.WIDTH;a.height=a.width/d}else{a.height=this.HEIGHT;a.width=a.height*d}case this.SCALES.CROP:default:}var c=new Circle({radius:this.CIRCLE_RADIUS,position:{x:f+this.CIRCLE_MARGIN*e,y:this.HEIGHT*this.CIRCLE_PERCENT_Y},color:e===0?this.CIRCLE_COLOR_ACTIVE:this.CIRCLE_COLOR,fillAlpha:e===0?this.CIRCLE_FILLALPHA_ACTIVE:this.CIRCLE_FILLALPHA,});this.indicators.push(c)}if(this.onInit){this.onInit()}};SlideManagerBase.prototype.SCALES={CROP:{},STRETCH:{},FIT:{}};SlideManager.prototype=Object.create(SlideManagerBase.prototype);function SlideManager(c,a,b){SlideManagerBase.call(this,c,a,b);this.textures=[];this.sprites=[];this.graphics=new PIXI.Graphics();this.stage=new PIXI.Container();this.renderer=PIXI.autoDetectRenderer(c,a,{view:b.view,backgroundColor:this.BKG_COLOR});this.hammertime=new Hammer(b.view);this.hammertime.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL});this.hammertime.get("pan").set({direction:Hammer.DIRECTION_HORIZONTAL,threshold:100})}SlideManager.prototype.render=function(){if(this.has_indicators){this.renderIndicators()}for(var c=0,b=this.slide_count;c<b;c++){var a=this.slides[c];var d=this.sprites[c];d.width=a.width;d.height=a.height}this.renderer.render(this.stage)};SlideManager.prototype.renderIndicators=function(){this.graphics.clear();var a=this.indicators.length;if(a>1){for(var b=0;b<a;b++){var c=this.indicators[b];this.graphics.beginFill(c.color);this.graphics.fillAlpha=c.fillAlpha;this.graphics.drawCircle(c.position.x,c.position.y,c.radius);this.graphics.endFill()}}};SlideManager.prototype.init=function(){SlideManagerBase.prototype.init.call(this);for(var e=0,g=this.slide_count;e<g;e++){var c=this.slides[e];if(c.img){var d=new PIXI.BaseTexture(c.img);var j=new PIXI.Texture(d)}else{var j=PIXI.Texture.fromImage(c.img_src)}j.crop=new PIXI.Rectangle(0,0,j.width,j.height);this.textures.push(j);var b=new PIXI.Sprite(j);b.width=c.width;b.height=c.height;b.anchor=c.anchor;b.position=c.position;this.sprites.push(b);this.stage.addChild(b);if(this.has_indicators){var a=this.indicators[e];this.graphics.beginFill(16777215);this.graphics.fillAlpha=a.fillAlpha;this.graphics.drawCircle(a.position.x,a.position.y,a.radius);this.graphics.endFill()}this.stage.addChild(this.graphics)}var k=[];var f="/wordpress/wp-content/themes/atelierbourgeons/img/sprite_icon_close_white.png";var h=PIXI.Texture.fromImage(f).baseTexture;for(var e=0;e<10;e++){j=new PIXI.Texture(h,{x:e*60,y:0,width:60,height:60});k.push(j)}this.close_sprite=new PIXI.extras.MovieClip(k);this.close_sprite.stop();this.close_sprite.hitArea=new PIXI.Circle(0,0,100);this.close_sprite.interactive=true;this.close_sprite.mouseover=function(){console.log("MOUSE OVER!");this.gotoAndStop(4);this.mouse_over=true};this.close_sprite.mouseout=function(){console.log("MOUSE OUT!");this.mouse_over=false};this.close_sprite.click=function(){console.log("MOUSE CLICK!");var i=$("#slider")[0];$(i).hide();$("body").css({"overflow-y":"scroll"})};this.close_sprite.position.x=this.WIDTH-100;this.close_sprite.position.y=100;this.stage.addChild(this.close_sprite)};SlideManager.prototype.enableSwipe=function(){this.hammertime.on("swipeleft panleft",function(c){this.slideLeft()}.bind(this));this.hammertime.on("swiperight panright",function(c){this.slideRight()}.bind(this));var b=this;var a=function(c){if(c.keyCode===65||c.keyCode===37){b.slideLeft()}if(c.keyCode===68||c.keyCode===39){b.slideRight()}};document.addEventListener("keydown",a);SlideManager.prototype.enableZoom=function(){this.hammertime.on("tap",function(c){if(this.state===this.states.inspecting){this.hammertime.get("pan").set({direction:Hammer.DIRECTION_HORIZONTAL,threshold:100});this.zoomOut()}else{this.hammertime.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:1});this.zoomIn()}}.bind(this));this.hammertime.on("pan",function(d){var c=this.getActiveSlide();if(c){if(this.state!==this.states.inspecting){return}d.preventDefault();this.panTo(c.temp_position.x+d.deltaX,c.temp_position.y+d.deltaY)}}.bind(this));this.hammertime.on("panend",function(d){var c=this.getActiveSlide();if(c){c.saveTempPosition()}}.bind(this))}};function UnitBezier(b,a,d,c){this.cx=3*b;this.bx=3*(d-b)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*a;this.by=3*(c-a)-this.cy;this.ay=1-this.cy-this.by}UnitBezier.prototype.epsilon=0.000001;UnitBezier.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a};UnitBezier.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a};UnitBezier.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx};UnitBezier.prototype.solveCurveX=function(a,h){var g;var f;var d;var b;var e;var c;for(d=a,c=0;c<8;c++){b=this.sampleCurveX(d)-a;if(Math.abs(b)<h){return d}e=this.sampleCurveDerivativeX(d);if(Math.abs(e)<h){break}d=d-b/e}g=0;f=1;d=a;if(d<g){return g}if(d>f){return f}while(g<f){b=this.sampleCurveX(d);if(Math.abs(b-a)<h){return d}if(a>b){g=d}else{f=d}d=(f-g)*0.5+g}return d};UnitBezier.prototype.solve=function(a,b){return this.sampleCurveY(this.solveCurveX(a,b))};