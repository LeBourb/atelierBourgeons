
(function(g){var a,h,b,i,d,c;var f={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,linkAttribute:"href",preventClicks:true,beforeShow:g.noop,beforeHide:g.noop,onShow:g.noop,onHide:g.noop,onMove:g.noop};function e(k,j){this.$target=g(k);this.opts=g.extend({},f,j,this.$target.data());this.isOpen===undefined&&this._init()}e.prototype._init=function(){this.$link=this.$target.find("a");this.$image=this.$target.find("img");this.$flyout=g('<div class="easyzoom-flyout" />');this.$notice=g('<div class="easyzoom-notice" />');this.$target.on({"mousemove.easyzoom touchmove.easyzoom":g.proxy(this._onMove,this),"mouseleave.easyzoom touchend.easyzoom":g.proxy(this._onLeave,this),"mouseenter.easyzoom touchstart.easyzoom":g.proxy(this._onEnter,this)});this.opts.preventClicks&&this.$target.on("click.easyzoom",function(j){j.preventDefault()})};e.prototype.show=function(o,p){var k,n,j,m;var l=this;if(this.opts.beforeShow.call(this)===false){return}if(!this.isReady){return this._loadImage(this.$link.attr(this.opts.linkAttribute),function(){if(l.isMouseOver||!p){l.show(o)}})}this.$target.append(this.$flyout);k=this.$target.width();n=this.$target.height();j=this.$flyout.width();m=this.$flyout.height();a=this.$zoom.width()-j;h=this.$zoom.height()-m;if(a<0){a=0}if(h<0){h=0}b=a/k;i=h/n;this.isOpen=true;this.opts.onShow.call(this);o&&this._move(o)};e.prototype._onEnter=function(k){var j=k.originalEvent.touches;this.isMouseOver=true;if(!j||j.length==1){k.preventDefault();this.show(k,true)}};e.prototype._onMove=function(j){if(!this.isOpen){return}j.preventDefault();this._move(j)};e.prototype._onLeave=function(){this.isMouseOver=false;this.isOpen&&this.hide()};e.prototype._onLoad=function(j){if(!j.currentTarget.width){return}this.isReady=true;this.$notice.detach();this.$flyout.html(this.$zoom);this.$target.removeClass("is-loading").addClass("is-ready");j.data.call&&j.data()};e.prototype._onError=function(){var j=this;this.$notice.text(this.opts.errorNotice);this.$target.removeClass("is-loading").addClass("is-error");this.detachNotice=setTimeout(function(){j.$notice.detach();j.detachNotice=null},this.opts.errorDuration)};e.prototype._loadImage=function(j,l){var k=new Image;this.$target.addClass("is-loading").append(this.$notice.text(this.opts.loadingNotice));this.$zoom=g(k).on("error",g.proxy(this._onError,this)).on("load",l,g.proxy(this._onLoad,this));k.style.position="absolute";k.src=j};e.prototype._move=function(o){if(o.type.indexOf("touch")===0){var q=o.touches||o.originalEvent.touches;d=q[0].pageX;c=q[0].pageY}else{d=o.pageX||d;c=o.pageY||c}var m=this.$target.offset();var r=c-m.top;var l=d-m.left;var j=Math.ceil(r*i);var n=Math.ceil(l*b);if(n<0||j<0||n>a||j>h){this.hide()}else{var p=j*-1;var k=n*-1;this.$zoom.css({top:p,left:k});this.opts.onMove.call(this,p,k)}};e.prototype.hide=function(){if(!this.isOpen){return}if(this.opts.beforeHide.call(this)===false){return}this.$flyout.detach();this.isOpen=false;this.opts.onHide.call(this)};e.prototype.swap=function(j,l,k){this.hide();this.isReady=false;this.detachNotice&&clearTimeout(this.detachNotice);this.$notice.parent().length&&this.$notice.detach();this.$target.removeClass("is-loading is-ready is-error");this.$image.attr({src:j,srcset:g.isArray(k)?k.join():k});this.$link.attr(this.opts.linkAttribute,l)};e.prototype.teardown=function(){this.hide();this.$target.off(".easyzoom").removeClass("is-loading is-ready is-error");this.detachNotice&&clearTimeout(this.detachNotice);delete this.$link;delete this.$zoom;delete this.$image;delete this.$notice;delete this.$flyout;delete this.isOpen;delete this.isReady};g.fn.easyZoom=function(j){return this.each(function(){var k=g.data(this,"easyZoom");if(!k){g.data(this,"easyZoom",new e(this,j))}else{if(k.isOpen===undefined){k._init()}}})};if(typeof define==="function"&&define.amd){define(function(){return e})}else{if(typeof module!=="undefined"&&module.exports){module.exports=e}}})(jQuery);